# 3co.app

### (Why is this site called 3co.app?)

This site is for a game called Killer Queen Black and in the game there are 3 ways to win:
1. Military (Mil) Victory - Kill the enemy queen 3 times
2. Snail Victory - Ride the snail all the way to your team's goal
3. Economic (Eco) Victory - Fill your hive with berries

There are 2 teams, each team has 1 queen and 3 workers. 3co, pronounced three-co, 
is the term for when all 3 workers on a single team work towards getting an Eco victory. 
If you see the 

###Why use the ".app" Top-Level Domain (TLD)?

The ".app" TLD prioritizes security and was the first
TLD that requires HTTPS for all connections. You can read more about this TLD in 
[Google's Announcement](https://blog.google/technology/developers/introducing-app-more-secure-home-apps-web/)

The site consists of various Killer Queen Black (KQB) leaderboards and resources for the community. 
The KQB community fairly small, my goal for this site is to foster community and 
give people a way to measure themselves against other community members instead of
solely relying on the in-game ranking system.

### Important note
In the KQB community, berries are colloquially referred to as "beans", this site uses the
terms "berries" and "beans" interchangeably.

## How it works

When playing KQB on Desktop via Steam, a file is generated after each match with all the
stats from that game. This site aggregates the stats from these files to create leaderboards.
Right now, the stats on this site are only from my personal account.
My goal is to create a portal for community members to upload their own match stat files
which would give us a larger dataset to pull from.

## Behind the scenes

The app is written in Python using Flask/JINJA and leverages Google Cloud Platform for the infrastructure.

It is deployed in the [Google Cloud Run](https://cloud.google.com/run), whenever a change is committed to
the main branch in GitHub, [Google Cloud Build](https://cloud.google.com/build) uses the Dockerfile to deploy a 
container containing the Flask app. This is a serverless deployment.

Data is sourced from JSON files generated by the game, the files are minimally transformed 
to add some metadata and convert the local timestamps to UTC before being uploaded to a 
[Google BigQuery](https://cloud.google.com/bigquery) database. The files are ingested 
into a main table called matchStats which has a schema that is nearly identical to the JSON files.

Whenever new data has been successfully inserted into the matchStats table, 
a message is posted to a Topic in [Google Pub/Sub](https://cloud.google.com/pubsub). 
That message triggers a [Google Cloud Function](https://cloud.google.com/functions)
that runs queries to create various aggregate tables used to populate the leaderboards.

## Roadmap

- [ ] Community JSON file upload page
- [ ] Alt/Smurf lookup
- [ ] Solo speed runs
- [ ] 3co only speed runs
- [ ] BGL 3co times
- [ ] BGL total match beans
- [ ] Lurk Bot (stay tuned...)
- [x] ~~QP/Ranked 3co times~~
- [x] ~~Total match beans~~